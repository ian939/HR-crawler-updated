<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BEP & ê²½ìŸì‚¬ ì±„ìš© í˜„í™© ëŒ€ì‹œë³´ë“œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body { background-color: #f8f9fa; font-family: 'Pretendard', sans-serif; }
        .container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        
        /* ìƒë‹¨ ë‹¤ìš´ë¡œë“œ ì„¹ì…˜ */
        .download-header { background: #e9ecef; padding: 15px; border-radius: 10px; margin-bottom: 25px; display: flex; justify-content: space-between; align-items: center; }
        .btn-download-csv { background-color: #198754; color: white; border: none; border-radius: 8px; padding: 8px 16px; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .btn-download-csv:hover { background-color: #146c43; }

        /* ê¸°ì—…ë³„ ìŒì˜ ìƒ‰ìƒ (í˜•ê´‘ íŒŒìŠ¤í…”í†¤) */
        .bg-evsis { background-color: rgba(255, 245, 157, 0.4) !important; } /* ë…¸ë‘ í˜•ê´‘ ëŠë‚Œ */
        .bg-pluglink { background-color: rgba(187, 222, 251, 0.4) !important; } /* íŒŒë‘ í˜•ê´‘ ëŠë‚Œ */
        .bg-everon { background-color: rgba(200, 230, 201, 0.4) !important; } /* ì´ˆë¡ í˜•ê´‘ ëŠë‚Œ */
        .bg-default { background-color: rgba(245, 245, 245, 1) !important; }

        .header-flex { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        
        /* ì™„ë£Œëœ ê³µê³  ìŠ¤íƒ€ì¼ */
        .completed-row { text-decoration: line-through !important; color: #adb5bd !important; background-color: #f2f2f2 !important; }
        .completed-row td { color: #adb5bd !important; border-bottom-color: #eee; }
        .completed-row .btn-link-custom { background-color: #6c757d; opacity: 0.5; pointer-events: none; }

        .btn-link-custom { background-color: #0d6efd; color: white; border-radius: 20px; padding: 5px 15px; text-decoration: none; font-size: 0.8rem; font-weight: 600; }
        .job-title { font-weight: 700; color: #2c3e50; }
        .task-text { font-size: 0.85rem; color: #444; max-width: 450px; line-height: 1.5; }
        .section-margin { margin-top: 3.5rem; }
    </style>
</head>
<body>

<div class="container mt-5 mb-5">
    <div class="download-header">
        <h5 class="mb-0">ğŸ“¥ ì‹¤ì‹œê°„ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</h5>
        <div>
            <button onclick="downloadCSV('saramin')" class="btn-download-csv">ê²½ìŸì‚¬ CSV ë‹¤ìš´ë¡œë“œ</button>
            <button onclick="downloadCSV('bep')" class="btn-download-csv">BEP CSV ë‹¤ìš´ë¡œë“œ</button>
        </div>
    </div>

    <div class="header-flex">
        <h2>ê²½ìŸì‚¬ ì±„ìš© í˜„í™©</h2>
        <span class="badge bg-light text-dark border" id="last-update-saramin">í™•ì¸ ì¤‘...</span>
    </div>
    <div class="table-responsive">
        <table class="table table-hover align-middle">
            <thead class="table-dark">
                <tr><th>ê¸°ì—…</th><th>ê³µê³ ëª…</th><th class="text-center">ê²½ë ¥</th><th class="text-center">ë“±ë¡ì¼</th><th class="text-center">ì™„ë£Œì¼</th><th class="text-center">ìƒì„¸ë³´ê¸°</th></tr>
            </thead>
            <tbody id="saramin-table-body"></tbody>
        </table>
    </div>

    <div class="header-flex section-margin">
        <h2>BEP ì±„ìš© í˜„í™©</h2>
        <span class="badge bg-light text-dark border" id="last-update-bep">í™•ì¸ ì¤‘...</span>
    </div>
    <div class="table-responsive">
        <table class="table table-hover align-middle">
            <thead class="table-dark">
                <tr><th style="width: 25%;">ê³µê³ ëª…</th><th style="width: 45%;">ì£¼ìš”ì—…ë¬´</th><th class="text-center">ë“±ë¡ì¼</th><th class="text-center">ì™„ë£Œì¼</th><th class="text-center">ìƒì„¸ë³´ê¸°</th></tr>
            </thead>
            <tbody id="bep-table-body"></tbody>
        </table>
    </div>
</div>

<script>
    const SARAMIN_URL = 'https://raw.githubusercontent.com/ian939/HR-crawler-updated/main/saramin_results.csv';
    const BEP_URL = 'https://raw.githubusercontent.com/ian939/HR-crawler-updated/main/BEP_EV_Recruitment_Master.csv';

    let rawData = { saramin: [], bep: [] };

    // ê¸°ì—…ë³„ ìƒ‰ìƒ ë§¤í•‘ í•¨ìˆ˜
    function getCompanyClass(companyName) {
        if (!companyName) return '';
        if (companyName.includes('ì´ë¸Œì´ì‹œìŠ¤')) return 'bg-evsis';
        if (companyName.includes('í”ŒëŸ¬ê·¸ë§í¬')) return 'bg-pluglink';
        if (companyName.includes('ì—ë²„ì˜¨')) return 'bg-everon';
        return 'bg-default';
    }

    function init() {
        loadData(SARAMIN_URL, 'saramin-table-body', 'saramin', 'last-update-saramin');
        loadData(BEP_URL, 'bep-table-body', 'bep', 'last-update-bep');
    }

    function loadData(url, tbodyId, type, updateId) {
        Papa.parse(url, {
            download: true, header: true, skipEmptyLines: true,
            transformHeader: h => h.trim().replace(/^\ufeff/, ""),
            complete: function(results) {
                rawData[type] = results.data;
                renderTable(results.data, tbodyId, type);
                document.getElementById(updateId).innerText = `ìµœì¢…ê°±ì‹ : ${new Date().toLocaleTimeString()}`;
            }
        });
    }

    function renderTable(data, tbodyId, type) {
        const tbody = document.getElementById(tbodyId);
        tbody.innerHTML = '';
        
        // ì •ë ¬: ì™„ë£Œëœ í•­ëª© í•˜ë‹¨ ë°°ì¹˜ ë° ë“±ë¡ì¼ ìµœì‹ ìˆœ
        data.sort((a, b) => {
            const dateA = (type === 'bep' ? a.first_seen : a['first-seen']) || '0';
            const dateB = (type === 'bep' ? b.first_seen : b['first-seen']) || '0';
            const compA = (a.completed_date && a.completed_date.trim() !== "" && a.completed_date !== "-") ? 1 : 0;
            const compB = (b.completed_date && b.completed_date.trim() !== "" && b.completed_date !== "-") ? 1 : 0;
            return (compA - compB) || (new Date(dateB) - new Date(dateA));
        });

        data.forEach(row => {
            const compDate = (row.completed_date || "").trim();
            const isCompleted = compDate !== "" && compDate !== "-";
            const tr = document.createElement('tr');
            
            // ìƒíƒœ ë° ê¸°ì—…ì— ë”°ë¥¸ í´ë˜ìŠ¤ ë¶€ì—¬
            if (isCompleted) {
                tr.className = 'completed-row';
            } else if (type === 'saramin') {
                tr.className = getCompanyClass(row['ê¸°ì—…ëª…']);
            }

            if (type === 'saramin') {
                tr.innerHTML = `
                    <td class="job-title">${row['ê¸°ì—…ëª…'] || '-'}</td>
                    <td class="task-text">${row['ê³µê³ ëª…'] || '-'}</td>
                    <td class="text-center">${row['ê²½ë ¥'] || '-'}</td>
                    <td class="text-center">${row['first-seen'] || '-'}</td>
                    <td class="text-center">${compDate || '-'}</td>
                    <td class="text-center"><a href="${row.URL}" target="_blank" class="btn-link-custom">ê³µê³ ë³´ê¸°</a></td>
                `;
            } else {
                const task = row['ì£¼ìš”ì—…ë¬´'] || "";
                const taskSummary = task.length > 55 ? task.substring(0, 55) + '...' : task;
                tr.innerHTML = `
                    <td class="job-title">${row['ê³µê³ ëª…'] || '-'}</td>
                    <td class="task-text" title="${task}">${taskSummary}</td>
                    <td class="text-center">${row.first_seen || '-'}</td>
                    <td class="text-center">${compDate || '-'}</td>
                    <td class="text-center"><a href="${row['ìƒì„¸URL']}" target="_blank" class="btn-link-custom">ê³µê³ ë³´ê¸°</a></td>
                `;
            }
            tbody.appendChild(tr);
        });
    }

    function downloadCSV(type) {
        const data = rawData[type];
        if (!data || data.length === 0) return alert("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
        const csv = Papa.unparse(data);
        const blob = new Blob(["\ufeff" + csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement("a");
        const url = URL.createObjectURL(blob);
        link.setAttribute("href", url);
        link.setAttribute("download", `${type}_ì±„ìš©í˜„í™©_${new Date().toISOString().slice(0,10)}.csv`);
        link.click();
    }

    init();
</script>
</body>
</html>
